{"version":3,"sources":["../../../../../../../app/infrastructure/http/routes/v1/account/controllers/update-of-a-user.ts","../../../../../../../app/infrastructure/datasources/databases/typeorm/models/enums.ts","../../../../../../../app/domain/models/bank/schemas/index.ts","../../../../../../../app/domain/models/user/schemas/index.ts","../../../../../../../app/domain/models/account/schemas/index.ts","../../../../../../../app/domain/errors/domain-error.ts","../../../../../../../app/domain/errors/validation-error.ts","../../../../../../../app/domain/errors/account/invalid-account-id-error.ts","../../../../../../../app/domain/models/account/value-objects/id.ts","../../../../../../../app/domain/models/account/value-objects/type.ts","../../../../../../../app/domain/use-cases/account/update-of-a-user/schemas.ts","../../../../../../../app/domain/use-cases/account/update-of-a-user/request.ts","../../../../../../../app/infrastructure/logger/index.ts","../../../../../../../app/infrastructure/http/routes/base/controller.ts"],"sourcesContent":["import { UpdateAccountOfUserUseCaseInterface } from \"@useCases/account/update-of-a-user/interfaces\";\nimport { UpdateAccountOfUserRequest } from \"@useCases/account/update-of-a-user/request\";\nimport { BaseController } from \"../../../base/controller\";\nimport { Request, Response } from \"express\";\n\nexport class UpdateAccountOfUserController extends BaseController {\n  constructor(private readonly useCase: UpdateAccountOfUserUseCaseInterface) {\n    super();\n  }\n\n  async handle(req: Request, res: Response): Promise<void> {\n    try {\n      const accountId = req.params.accountId;\n      if (!this.validateRequiredParam(accountId, \"Account ID\", res)) return;\n\n      const request = UpdateAccountOfUserRequest.createFromRaw({\n        accountId,\n        ...req.body,\n      });\n\n      const response = await this.useCase.execute(request);\n\n      if (response.isSuccess()) {\n        this.sendSuccessResponse(res, \"Account updated successfully\", response.getData(), 200);\n        return;\n      }\n\n      const statusCode = this.getErrorStatusCode(\"UpdateAccount\", !!response.getValidationErrors());\n      this.sendErrorResponse(res, response.getError() || \"Failed to update account\", response.getValidationErrors(), statusCode);\n    } catch (error) {\n      this.handleControllerError(error, res, \"UpdateAccountOfUserController\");\n    }\n  }\n}","export enum AccountType {\n  CORRENTE = \"Corrente\",\n  POUPANCA = \"Poupança\",\n  CREDITO = \"Crédito\",\n  INVESTIMENTO = \"Investimento\",\n} \n\nexport enum TransactionType {\n  DEBITO = \"Débito\",\n  CREDITO = \"Crédito\",\n  TRANSFERENCIA = \"Transferência\",\n}\n","import { z } from \"zod\";\n\nexport class BankSchemas {\n\n  public static readonly nameSchema = z\n    .string()\n    .min(2, \"Name must have at least 2 characters\")\n    .max(100, \"Name cannot exceed 100 characters\")\n    .regex(/^[a-zA-ZÀ-ÿ\\s]+$/, \"Name can only contain letters and spaces\");\n\n  public static readonly createBankSchema = z.object({\n    name: this.nameSchema,\n  });\n\n  public static readonly bankEntitySchema = z.object({\n    name: this.nameSchema,\n  });\n}\n\n","import { z } from \"zod\";\n\nexport class UserSchemas {\n  public static readonly emailSchema = z\n    .string()\n    .email(\"Invalid email format\")\n    .min(1, \"Email is required\")\n    .max(255, \"Email cannot exceed 255 characters\");\n\n  public static readonly nameSchema = z\n    .string()\n    .min(2, \"Name must have at least 2 characters\")\n    .max(100, \"Name cannot exceed 100 characters\")\n    .regex(/^[a-zA-ZÀ-ÿ\\s]+$/, \"Name can only contain letters and spaces\");\n\n  public static readonly userIdSchema = z\n    .number()\n    .int(\"User ID must be an integer\")\n    .positive(\"User ID must be positive\");\n\n  public static readonly passwordSchema = z\n    .string()\n    .min(8, \"Password must be at least 8 characters\")\n    .regex(\n      /^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,}$/,\n      \"Password must contain uppercase, lowercase, number and special character\",\n    );\n\n  public static readonly createUserSchema = z.object({\n    name: this.nameSchema,\n    email: this.emailSchema,\n    passwordHash: z.string().min(8, \"Password hash is required\"),\n  });\n\n  public static readonly userEntitySchema = z.object({\n    id: this.userIdSchema,\n    name: this.nameSchema,\n    email: this.emailSchema,\n    createdAt: z.date(),\n    passwordHash: z.string().min(8, \"Password hash is required\"),\n  });\n}\n","import { AccountType } from \"@infrastructure/datasources/databases/typeorm/models/enums\";\nimport { BankSchemas } from \"@models/bank/schemas\";\nimport { UserSchemas } from \"@models/user/schemas\";\nimport { z } from \"zod\";\n\nexport class AccountSchemas {\n  public static readonly nameSchema = z\n    .string()\n    .min(2, \"Name must have at least 2 characters\")\n    .max(100, \"Name cannot exceed 100 characters\")\n    .regex(/^[a-zA-ZÀ-ÿ\\s]+$/, \"Name can only contain letters and spaces\");\n\n  public static readonly accountIdSchema = z\n    .number()\n    .int(\"Account ID must be an integer\")\n    .positive(\"Account ID must be positive\");\n\n  public static readonly accountTypeSchema = z.nativeEnum(AccountType);\n\n  public static readonly balanceSchema = z\n    .number()\n    // .max(9999999999, \"Balance is too high\")\n    // .min(-9999999999, \"Balance is too low\")\n    .refine((val) => Number.isFinite(val), {\n      message: \"Balance must be a finite number\",\n    });\n\n  public static readonly createAccountSchema = z.object({\n    type: this.accountTypeSchema,\n    balance: this.balanceSchema,\n    userId: UserSchemas.userIdSchema,\n    bankName: BankSchemas.nameSchema,\n  });\n\n  public static readonly accountEntitySchema = z.object({\n    id: this.accountIdSchema,\n    name: this.nameSchema,\n    type: this.accountTypeSchema,\n    balance: this.balanceSchema,\n    createdAt: z.date(),\n  });\n}\n","export abstract class DomainError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = this.constructor.name;\n    Object.setPrototypeOf(this, DomainError.prototype);\n  }\n\n  public abstract getStatusCode(): number;\n} ","import { DomainError } from \"./domain-error\";\n\nexport class ValidationError extends DomainError {\n  constructor(message: string, private readonly errors: string[] = []) {\n    super(message);\n    Object.setPrototypeOf(this, ValidationError.prototype);\n  }\n\n  public getStatusCode(): number {\n    return 400;\n  }\n\n  public getErrors(): string[] {\n    return this.errors;\n  }\n} ","import { ValidationError } from \"../validation-error\";\n\nexport class InvalidAccountIdError extends ValidationError {\n  constructor() {\n    super('Cannot get value of new AccountId before persistence');\n    Object.setPrototypeOf(this, InvalidAccountIdError.prototype);\n  }\n} ","import { AccountSchemas } from \"@models/account/schemas\";\nimport { InvalidAccountIdError } from \"@errors/account/invalid-account-id-error\";\n\nexport class AccountId {\n  private constructor(\n    private readonly value: number | null,\n    private readonly isNewId: boolean = false,\n  ) {}\n\n    public static create(id: number): AccountId {\n    const validatedId = AccountSchemas.accountIdSchema.parse(id);\n    return new AccountId(validatedId, false);\n  }\n\n  public static createNew(): AccountId {\n    return new AccountId(null, true);\n  }\n\n  public static createFromDatabase(id: number): AccountId {\n    const validatedId = AccountSchemas.accountIdSchema.parse(id);\n    return new AccountId(validatedId, false);\n  }\n\n  public static createUnsafe(id: number): AccountId {\n    return new AccountId(id, false);\n  }\n\n  public getValue(): number {\n    if (this.value === null) {\n      throw new InvalidAccountIdError();\n    }\n    return this.value;\n  }\n\n  public isNew(): boolean {\n    return this.isNewId;\n  }\n\n  public equals(other: AccountId): boolean {\n    return this.value === other.value;\n  }\n\n  public toString(): string {\n    return this.value?.toString() ?? \"\";\n  }\n}\n","import { AccountType } from \"@infrastructure/datasources/databases/typeorm/models/enums\";\nimport { AccountSchemas } from \"@models/account/schemas\";\n\nexport class AccountTypeVO {\n  private constructor(private value: AccountType) {}\n\n  public static create(type: unknown): AccountTypeVO {\n    const validatedType = AccountSchemas.accountTypeSchema.parse(type);\n    return new AccountTypeVO(validatedType);\n  }\n\n  public getValue(): AccountType {\n    return this.value;\n  }\n  \n  public setValue(value: AccountType): void {\n    this.value = value;\n  }\n}\n","import { AccountSchemas } from \"@models/account/schemas\";\nimport { z } from \"zod\";\n\nexport class UpdateAccountOfUserSchemas {\n  public static readonly requestSchema = z.object({\n    accountId: AccountSchemas.accountIdSchema,\n    account: z.object({\n      type: AccountSchemas.accountTypeSchema.optional(),\n    }),\n  });\n\n  public static readonly httpRequestSchema = z.object({\n    params: z.object({\n      accountId: AccountSchemas.accountIdSchema,\n    }),\n    body: this.requestSchema,\n  });\n}\n","import { AccountId } from \"@models/account/value-objects/id\";\nimport { AccountTypeVO } from \"@models/account/value-objects/type\";\nimport { UpdateAccountOfUserSchemas } from \"@useCases/account/update-of-a-user/schemas\";\n\nexport class UpdateAccountOfUserRequest {\n  constructor(\n    private readonly accountId: AccountId,\n    private readonly accountType?: AccountTypeVO,\n  ) {}\n\n  public getAccountId(): number {\n    return this.accountId.getValue();\n  }\n\n  public getAccountIdVO(): AccountId {\n    return this.accountId;\n  }\n\n  public getAccountType(): AccountTypeVO {\n    if (!this.accountType) {\n      throw new Error(\"Account type not provided\");\n    }\n    return this.accountType;\n  }\n\n  public hasAccountType(): boolean {\n    return this.accountType !== undefined;\n  }\n\n  public static createFromRaw(raw: unknown): UpdateAccountOfUserRequest {\n    const parsed = UpdateAccountOfUserSchemas.httpRequestSchema.parse(raw);\n    \n    const accountType = parsed.body.account.type \n      ? AccountTypeVO.create(parsed.body.account.type) \n      : undefined;\n\n    return new UpdateAccountOfUserRequest(\n      AccountId.create(parsed.params.accountId),\n      accountType\n    );\n  }\n}","import winston from \"winston\";\n\nconst consoleFormat = winston.format.combine(\n  winston.format.timestamp({ format: \"YYYY-MM-DD HH:mm:ss\" }),\n  winston.format.errors({ stack: true }),\n  winston.format.printf((info) => {\n    const { timestamp, level, message, stack, ...meta } = info;\n\n    const levelColors: Record<string, string> = {\n      error: \"\\x1b[31m\", // red\n      warn: \"\\x1b[33m\", // yellow\n      info: \"\\x1b[32m\", // green\n      debug: \"\\x1b[36m\", // cyan\n      verbose: \"\\x1b[35m\", // magenta\n    };\n\n    const resetColor = \"\\x1b[0m\";\n    const levelColor = levelColors[level] || \"\";\n\n    let logMessage = `${timestamp} [${levelColor}${level.toUpperCase()}${resetColor}]: ${message}`;\n\n    if (stack) {\n      logMessage += `\\n${stack}`;\n    }\n\n    const excludeFields = [\"timestamp\", \"level\", \"message\", \"stack\"];\n    const filteredMeta = Object.keys(meta)\n      .filter((key) => !excludeFields.includes(key))\n      .reduce(\n        (obj, key) => {\n          obj[key] = meta[key];\n          return obj;\n        },\n        {} as Record<string, unknown>,\n      );\n\n    const metaKeys = Object.keys(filteredMeta);\n    if (metaKeys.length > 0) {\n      const metaString = JSON.stringify(filteredMeta, null, 2);\n      logMessage += `\\n${metaString}`;\n    }\n\n    return logMessage;\n  }),\n);\n\nconst isProduction = process.env.NODE_ENV === \"production\";\n\nexport const logger = winston.createLogger({\n  level: process.env.LOG_LEVEL || (isProduction ? \"warn\" : \"debug\"),\n  defaultMeta: {\n    service: \"tech4humans\",\n    environment: process.env.NODE_ENV || \"development\",\n  },\n  transports: [\n    new winston.transports.Console({\n      format: consoleFormat,\n      handleExceptions: true,\n      handleRejections: true,\n    }),\n  ],\n  exitOnError: false,\n});\n\nexport const morganStream = {\n  write: (message: string) => {\n    logger.info(message.trim(), { component: \"http\" });\n  },\n};\n\nexport const logWithContext = {\n  database: (message: string, meta?: object) => {\n    logger.info(message, { component: \"database\", ...meta });\n  },\n\n  server: (message: string, meta?: object) => {\n    logger.info(message, { component: \"server\", ...meta });\n  },\n\n  auth: (message: string, meta?: object) => {\n    logger.info(message, { component: \"auth\", ...meta });\n  },\n\n  api: (message: string, meta?: object) => {\n    logger.info(message, { component: \"api\", ...meta });\n  },\n\n  error: (message: string, error?: Error, meta?: object) => {\n    logger.error(message, {\n      error: error?.message,\n      stack: error?.stack,\n      ...meta,\n    });\n  },\n};\n","import { logger } from \"@infrastructure/logger\";\nimport { Response } from \"express\";\nimport { ZodError } from \"zod\";\n\nexport abstract class BaseController {\n  protected sendSuccessResponse(\n    res: Response,\n    message: string,\n    data?: unknown,\n    statusCode: number = 200,\n  ): void {\n    const response: any = {\n      message,\n    };\n\n    if (data !== undefined) {\n      response.data = data;\n    }\n\n    res.status(statusCode).json(response);\n  }\n\n  protected sendErrorResponse(\n    res: Response,\n    message: string,\n    errors: string[] = [],\n    statusCode: number = 422,\n  ): void {\n    logger.error(\"BaseController.sendErrorResponse\", message);\n    res.status(statusCode).json({\n      message,\n      errors,\n    });\n  }\n\n  protected getErrorStatusCode(\n    message: string,\n    hasValidationErrors: boolean,\n  ): number {\n    if (hasValidationErrors) return 400;\n\n    const lowerMessage = message.toLowerCase();\n\n    if (\n      lowerMessage.includes(\"invalid credentials\") ||\n      lowerMessage.includes(\"authentication failed\")\n    ) {\n      return 401;\n    }\n\n    if (\n      lowerMessage.includes(\"unauthorized\") ||\n      lowerMessage.includes(\"permission\") ||\n      lowerMessage.includes(\"account locked\") ||\n      lowerMessage.includes(\"account disabled\")\n    ) {\n      return 403;\n    }\n\n    if (lowerMessage.includes(\"not found\")) {\n      return 404;\n    }\n\n    if (\n      lowerMessage.includes(\"already exists\") ||\n      lowerMessage.includes(\"duplicate\")\n    ) {\n      return 409;\n    }\n\n    return 422;\n  }\n\n  protected handleControllerError(\n    error: unknown,\n    res: Response,\n    controllerName: string,\n  ): void {\n    if (error instanceof ZodError) {\n      const errors = error.errors.map((err) => ({\n        field: err.path.join(\".\"),\n        message: err.message,\n        code: err.code,\n      }));\n      res.status(400).json({\n        success: false,\n        message: \"Invalid request format\",\n        errors,\n      });\n      return;\n    }\n\n    logger.error(`${controllerName} Error:`, error);\n    res.status(500).json({\n      success: false,\n      message: error instanceof Error ? error.message : \"Internal server error\",\n    });\n  }\n\n  protected validateRequiredParam(\n    param: string | undefined,\n    paramName: string,\n    res: Response,\n  ): boolean {\n    if (!param) {\n      this.sendErrorResponse(\n        res,\n        `${paramName} is required`,\n        [`${paramName} parameter is missing`],\n        400,\n      );\n      return false;\n    }\n    return true;\n  }\n}\n"],"mappings":"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","names":["AccountType","BankSchemas","nameSchema","z","string","min","max","regex","createBankSchema","object","name","bankEntitySchema","import_zod","UserSchemas","emailSchema","z","string","email","min","max","nameSchema","regex","userIdSchema","number","int","positive","passwordSchema","createUserSchema","object","name","passwordHash","userEntitySchema","id","createdAt","date","import_zod","AccountSchemas","nameSchema","z","string","min","max","regex","accountIdSchema","number","int","positive","accountTypeSchema","nativeEnum","AccountType","balanceSchema","refine","val","Number","isFinite","message","createAccountSchema","object","type","balance","userId","UserSchemas","userIdSchema","bankName","BankSchemas","accountEntitySchema","id","name","createdAt","date","DomainError","Error","constructor","message","name","Object","setPrototypeOf","prototype","ValidationError","DomainError","constructor","message","errors","Object","setPrototypeOf","prototype","getStatusCode","getErrors","InvalidAccountIdError","ValidationError","constructor","Object","setPrototypeOf","prototype","AccountId","value","isNewId","create","id","validatedId","AccountSchemas","accountIdSchema","parse","createNew","createFromDatabase","createUnsafe","getValue","InvalidAccountIdError","isNew","equals","other","toString","AccountTypeVO","value","create","type","validatedType","AccountSchemas","accountTypeSchema","parse","getValue","setValue","import_zod","UpdateAccountOfUserSchemas","requestSchema","z","object","accountId","AccountSchemas","accountIdSchema","account","type","accountTypeSchema","optional","httpRequestSchema","params","body","UpdateAccountOfUserRequest","constructor","accountId","accountType","getAccountId","getValue","getAccountIdVO","getAccountType","Error","hasAccountType","undefined","createFromRaw","raw","parsed","UpdateAccountOfUserSchemas","httpRequestSchema","parse","body","account","type","AccountTypeVO","create","AccountId","params","consoleFormat","winston","format","combine","timestamp","errors","stack","printf","info","level","message","meta","levelColors","error","warn","debug","verbose","resetColor","levelColor","logMessage","toUpperCase","excludeFields","filteredMeta","Object","keys","filter","key","includes","reduce","obj","metaKeys","length","metaString","JSON","stringify","isProduction","process","env","NODE_ENV","logger","createLogger","LOG_LEVEL","defaultMeta","service","environment","transports","Console","handleExceptions","handleRejections","exitOnError","import_zod","BaseController","sendSuccessResponse","res","message","data","statusCode","response","undefined","status","json","sendErrorResponse","errors","logger","error","getErrorStatusCode","hasValidationErrors","lowerMessage","toLowerCase","includes","handleControllerError","controllerName","ZodError","map","err","field","path","join","code","success","Error","validateRequiredParam","param","paramName","UpdateAccountOfUserController","BaseController","constructor","useCase","handle","req","res","accountId","params","validateRequiredParam","request","UpdateAccountOfUserRequest","createFromRaw","body","response","execute","isSuccess","sendSuccessResponse","getData","statusCode","getErrorStatusCode","getValidationErrors","sendErrorResponse","getError","error","handleControllerError"]}